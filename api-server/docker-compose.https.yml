services:
  api-server:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: pingmailer-api-server
    restart: unless-stopped
    
    # HTTPS mode
    ports:
      - "8443:8443"
    
    environment:
      - PORT=8443
      - CERT_FILE=/certs/live/yourdomain.co/fullchain.pem
      - KEY_FILE=/certs/live/yourdomain.co/privkey.pem
    
    # Mount entire certbot etc directory to preserve symlinks
    # This allows Docker to follow the symlinks to the archive directory
    volumes:
      - ../mail-infra/services/silver-config/certbot/keys/etc:/certs:ro
    
    # Join the mail network to integrate with mail services
    networks:
      - mail-network

networks:
  mail-network:
    external: true
